# ------------------------------------------------------------------------
# OWASP ModSecurity Core Rule Set v4.3.0
# Production-ready crs-setup.conf
# ------------------------------------------------------------------------

# Load CRS in anomaly scoring mode
SecDefaultAction "phase:1,log,auditlog,pass"
SecDefaultAction "phase:2,log,auditlog,pass"

# ------------------------------------------------------------------------
# Paranoia Level (defaults to PL1)
# ------------------------------------------------------------------------
SecAction \
 "id:900000,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.paranoia_level=1"

# Executing paranoia level (same as PL unless overridden)
SecAction \
 "id:900001,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.executing_paranoia_level=1"

# ------------------------------------------------------------------------
# Application-specific exclusions
# Preserving your previous list
# ------------------------------------------------------------------------
SecAction \
 "id:900130,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_cpanel=1,\
  setvar:tx.crs_exclusions_drupal=1,\
  setvar:tx.crs_exclusions_dokuwiki=1,\
  setvar:tx.crs_exclusions_nextcloud=1,\
  setvar:tx.crs_exclusions_wordpress=1,\
  setvar:tx.crs_exclusions_xenforo=1"

# ------------------------------------------------------------------------
# Anomaly Threshold
# ------------------------------------------------------------------------
SecAction \
 "id:900110,\
  phase:1,\
  pass,\
  nolog,\
  setvar:tx.inbound_anomaly_score_threshold=5,\
  setvar:tx.outbound_anomaly_score_threshold=5"

# ------------------------------------------------------------------------
# Collection timeout (default 600 seconds)
# ------------------------------------------------------------------------
SecCollectionTimeout 600

# ------------------------------------------------------------------------
# CRS version marker for setup validation
# ------------------------------------------------------------------------
SecAction \
 "id:900990,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_setup_version=430"

#
# WordPress admin/login stability exclusions (CRS 4.x)
#

# wp-login.php (passwords, redirects, cookies often trigger false positives)
SecRule REQUEST_URI "@streq /wp-login.php" \
  "id:9003000,phase:1,pass,nolog,ctl:ruleEngine=DetectionOnly"

# wp-admin area: start by observing only, then tighten later
SecRule REQUEST_URI "@beginsWith /wp-admin/" \
  "id:9003001,phase:1,pass,nolog,ctl:ruleEngine=DetectionOnly"

#
# -- WordPress Core Exclusions -----------------------------------------
#

# Allow WordPress heartbeat endpoints (backend quotas, autosave, keepalive)
SecRule REQUEST_URI "@beginsWith /wp-admin/admin-ajax.php" \
    "id:9002000,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# Allow WordPress Gutenberg JSON API
SecRule REQUEST_URI "@beginsWith /wp-json/" \
    "id:9002001,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# Classic editor / plugin settings often embed HTML in POST
SecRule REQUEST_URI "@beginsWith /wp-admin/post.php" \
    "id:9002002,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# Allow WordPress media uploads
SecRule REQUEST_URI "@beginsWith /wp-admin/async-upload.php" \
    "id:9002003,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

#
# -- WordPress Common Plugin Exclusions --------------------------------
#

# Gravity Forms
SecRule REQUEST_URI "@contains /wp-admin/admin-ajax.php?action=gf" \
    "id:9002004,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# Contact Form 7
SecRule REQUEST_URI "@contains /wp-json/contact-form-7/" \
    "id:9002005,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# WooCommerce REST API
SecRule REQUEST_URI "@beginsWith /wc-api/" \
   "id:9002006,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"

# WooCommerce cart, checkout, sessions
SecRule REQUEST_URI "@beginsWith /?wc-ajax=" \
   "id:9002007,phase:1,nolog,pass,setvar:tx.crs_exclusions_wordpress=1"


#
# -- Drupal Core Exclusions --------------------------------------------
#

# Drupal admin AJAX + form submission
SecRule REQUEST_URI "@beginsWith /core/authorize.php" \
    "id:9002100,phase:1,nolog,pass,setvar:tx.crs_exclusions_drupal=1"

SecRule REQUEST_URI "@beginsWith /core/install.php" \
    "id:9002101,phase:1,nolog,pass,setvar:tx.crs_exclusions_drupal=1"

# Drupal JSON:API endpoints
SecRule REQUEST_URI "@beginsWith /jsonapi/" \
    "id:9002102,phase:1,nolog,pass,setvar:tx.crs_exclusions_drupal=1"

#
# -- Drupal Form API checks (widely used in admin forms) ----------------
#

SecRule ARGS_NAMES "@endsWith _token" \
    "id:9002103,phase:1,nolog,pass,setvar:tx.crs_exclusions_drupal=1"

SecRule REQUEST_URI "@contains /user/login" \
    "id:9002104,phase:1,nolog,pass,setvar:tx.crs_exclusions_drupal=1"

#
# -- Drupal public files (CSS, JS, images) ------------------------------
#
SecRule REQUEST_URI "@beginsWith /sites/default/files/" \
  "id:9003200,phase:1,pass,nolog,\
   ctl:ruleEngine=Off"

#
# -- CiviCRM Exclusions --------------------------------------------------
#

# Main CiviCRM entry point
SecRule REQUEST_URI "@beginsWith /civicrm" \
    "id:9002200,phase:1,nolog,pass,setvar:tx.crs_exclusions_civicrm=1"

# CiviCRM AJAX
SecRule REQUEST_URI "@contains /civicrm/ajax/" \
    "id:9002201,phase:1,nolog,pass,setvar:tx.crs_exclusions_civicrm=1"

# CiviCRM REST endpoints
SecRule REQUEST_URI "@contains /civicrm/rest/" \
    "id:9002202,phase:1,nolog,pass,setvar:tx.crs_exclusions_civicrm=1"

# CiviCRM contribution transactions
SecRule REQUEST_URI "@contains /civicrm/payment/ipn" \
    "id:9002203,phase:1,nolog,pass,setvar:tx.crs_exclusions_civicrm=1"

# CiviCRM WYSIWYG editors, HTML fields, etc.
SecRule ARGS_NAMES "@rx (html|editor|wysiwyg|custom|description)" \
    "id:9002204,phase:1,nolog,pass,setvar:tx.crs_exclusions_civicrm=1"

#
# Verified safe for hardened WordPress/Drupal/CiviCRM hosting
#
